{"version":3,"sources":["webpack:///./public/app/features/datasources/utils/passwordHandlers.ts","webpack:///./public/app/plugins/datasource/mssql/response_parser.ts","webpack:///./public/app/plugins/datasource/mssql/datasource.ts","webpack:///./public/app/plugins/datasource/mssql/query_ctrl.ts","webpack:///./public/app/plugins/datasource/mssql/config_ctrl.ts","webpack:///./public/app/plugins/datasource/mssql/module.ts"],"names":["PasswordFieldEnum","createResetHandler","ctrl","field","event","preventDefault","current","secureJsonFields","secureJsonData","createChangeHandler","currentTarget","value","ResponseParser","res","data","results","key","queryRes","series","push","target","name","datapoints","points","refId","meta","tables","table","type","length","rowCount","columns","rows","textColIndex","this","findColIndex","valueColIndex","transformToKeyValueList","transformToSimpleList","i","containsKey","text","j","indexOf","_","map","colName","options","annotation","timeColumnIndex","timeEndColumnIndex","textColumnIndex","tagsColumnIndex","Promise","reject","message","list","row","timeEnd","Math","floor","undefined","time","tags","trim","split","MssqlDatasource","instanceSettings","templateSrv","timeSrv","id","responseParser","interval","jsonData","timeInterval","variable","multi","includeAll","replace","val","join","queries","scopedVars","expandedQueries","query","datasource","rawSql","interpolateVariable","filter","targets","item","hide","intervalMs","maxDataPoints","datasourceId","format","resolve","getBackendSrv","datasourceRequest","url","method","from","range","valueOf","toString","to","then","processQueryResult","rawQuery","transformAnnotationResponse","optionalOptions","interpolatedQuery","timeRange","parseMetricFindQueryResult","status","catch","err","console","log","variableExists","MssqlQueryCtrl","$scope","$injector","alias","formats","panelCtrl","panel","events","on","PanelEvents","dataReceived","onDataReceived","bind","dataError","onDataError","dataList","lastQueryMeta","lastQueryError","anySeriesFromQuery","find","error","QueryCtrl","templateUrl","MssqlConfigCtrl","encrypt","onPasswordReset","Password","onPasswordChange","MssqlAnnotationsQueryCtrl"],"mappings":"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","file":"mssqlPlugin.fc25e2ef18cf58c0ed79.js","sourcesContent":["/**\n * Set of handlers for secure password field in Angular components. They handle backward compatibility with\n * passwords stored in plain text fields.\n */\n\nimport { SyntheticEvent } from 'react';\n\nexport enum PasswordFieldEnum {\n  Password = 'password',\n  BasicAuthPassword = 'basicAuthPassword',\n}\n\n/**\n * Basic shape for settings controllers in at the moment mostly angular datasource plugins.\n */\nexport type Ctrl = {\n  current: {\n    secureJsonFields: {\n      [key: string]: boolean;\n    };\n    secureJsonData?: {\n      [key: string]: string;\n    };\n    password?: string;\n    basicAuthPassword?: string;\n  };\n};\n\nexport const createResetHandler = (ctrl: Ctrl, field: PasswordFieldEnum) => (\n  event: SyntheticEvent<HTMLInputElement>\n) => {\n  event.preventDefault();\n  // Reset also normal plain text password to remove it and only save it in secureJsonData.\n  ctrl.current[field] = null;\n  ctrl.current.secureJsonFields[field] = false;\n  ctrl.current.secureJsonData = ctrl.current.secureJsonData || {};\n  ctrl.current.secureJsonData[field] = '';\n};\n\nexport const createChangeHandler = (ctrl: any, field: PasswordFieldEnum) => (\n  event: SyntheticEvent<HTMLInputElement>\n) => {\n  ctrl.current.secureJsonData = ctrl.current.secureJsonData || {};\n  ctrl.current.secureJsonData[field] = event.currentTarget.value;\n};\n","import _ from 'lodash';\n\nexport default class ResponseParser {\n  processQueryResult(res: any) {\n    const data: any[] = [];\n\n    if (!res.data.results) {\n      return { data };\n    }\n\n    for (const key in res.data.results) {\n      const queryRes = res.data.results[key];\n\n      if (queryRes.series) {\n        for (const series of queryRes.series) {\n          data.push({\n            target: series.name,\n            datapoints: series.points,\n            refId: queryRes.refId,\n            meta: queryRes.meta,\n          });\n        }\n      }\n\n      if (queryRes.tables) {\n        for (const table of queryRes.tables) {\n          table.type = 'table';\n          table.refId = queryRes.refId;\n          table.meta = queryRes.meta;\n          data.push(table);\n        }\n      }\n    }\n\n    return { data: data };\n  }\n\n  parseMetricFindQueryResult(refId: string, results: any) {\n    if (!results || results.data.length === 0 || results.data.results[refId].meta.rowCount === 0) {\n      return [];\n    }\n\n    const columns = results.data.results[refId].tables[0].columns;\n    const rows = results.data.results[refId].tables[0].rows;\n    const textColIndex = this.findColIndex(columns, '__text');\n    const valueColIndex = this.findColIndex(columns, '__value');\n\n    if (columns.length === 2 && textColIndex !== -1 && valueColIndex !== -1) {\n      return this.transformToKeyValueList(rows, textColIndex, valueColIndex);\n    }\n\n    return this.transformToSimpleList(rows);\n  }\n\n  transformToKeyValueList(rows: any, textColIndex: number, valueColIndex: number) {\n    const res = [];\n\n    for (let i = 0; i < rows.length; i++) {\n      if (!this.containsKey(res, rows[i][textColIndex])) {\n        res.push({ text: rows[i][textColIndex], value: rows[i][valueColIndex] });\n      }\n    }\n\n    return res;\n  }\n\n  transformToSimpleList(rows: any) {\n    const res = [];\n\n    for (let i = 0; i < rows.length; i++) {\n      for (let j = 0; j < rows[i].length; j++) {\n        const value = rows[i][j];\n        if (res.indexOf(value) === -1) {\n          res.push(value);\n        }\n      }\n    }\n\n    return _.map(res, value => {\n      return { text: value };\n    });\n  }\n\n  findColIndex(columns: any[], colName: string) {\n    for (let i = 0; i < columns.length; i++) {\n      if (columns[i].text === colName) {\n        return i;\n      }\n    }\n\n    return -1;\n  }\n\n  containsKey(res: any[], key: any) {\n    for (let i = 0; i < res.length; i++) {\n      if (res[i].text === key) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  transformAnnotationResponse(options: any, data: any) {\n    const table = data.data.results[options.annotation.name].tables[0];\n\n    let timeColumnIndex = -1;\n    let timeEndColumnIndex = -1;\n    let textColumnIndex = -1;\n    let tagsColumnIndex = -1;\n\n    for (let i = 0; i < table.columns.length; i++) {\n      if (table.columns[i].text === 'time') {\n        timeColumnIndex = i;\n      } else if (table.columns[i].text === 'timeend') {\n        timeEndColumnIndex = i;\n      } else if (table.columns[i].text === 'text') {\n        textColumnIndex = i;\n      } else if (table.columns[i].text === 'tags') {\n        tagsColumnIndex = i;\n      }\n    }\n\n    if (timeColumnIndex === -1) {\n      return Promise.reject({ message: 'Missing mandatory time column (with time column alias) in annotation query.' });\n    }\n\n    const list = [];\n    for (let i = 0; i < table.rows.length; i++) {\n      const row = table.rows[i];\n      const timeEnd =\n        timeEndColumnIndex !== -1 && row[timeEndColumnIndex] ? Math.floor(row[timeEndColumnIndex]) : undefined;\n      list.push({\n        annotation: options.annotation,\n        time: Math.floor(row[timeColumnIndex]),\n        timeEnd,\n        text: row[textColumnIndex],\n        tags: row[tagsColumnIndex] ? row[tagsColumnIndex].trim().split(/\\s*,\\s*/) : [],\n      });\n    }\n\n    return list;\n  }\n}\n","import _ from 'lodash';\nimport ResponseParser from './response_parser';\nimport { getBackendSrv } from '@grafana/runtime';\nimport { ScopedVars } from '@grafana/data';\nimport { TemplateSrv } from 'app/features/templating/template_srv';\nimport { TimeSrv } from 'app/features/dashboard/services/TimeSrv';\n//Types\nimport { MssqlQueryForInterpolation } from './types';\n\nexport class MssqlDatasource {\n  id: any;\n  name: any;\n  responseParser: ResponseParser;\n  interval: string;\n\n  /** @ngInject */\n  constructor(instanceSettings: any, private templateSrv: TemplateSrv, private timeSrv: TimeSrv) {\n    this.name = instanceSettings.name;\n    this.id = instanceSettings.id;\n    this.responseParser = new ResponseParser();\n    this.interval = (instanceSettings.jsonData || {}).timeInterval || '1m';\n  }\n\n  interpolateVariable(value: any, variable: any) {\n    if (typeof value === 'string') {\n      if (variable.multi || variable.includeAll) {\n        return \"'\" + value.replace(/'/g, `''`) + \"'\";\n      } else {\n        return value;\n      }\n    }\n\n    if (typeof value === 'number') {\n      return value;\n    }\n\n    const quotedValues = _.map(value, val => {\n      if (typeof value === 'number') {\n        return value;\n      }\n\n      return \"'\" + val.replace(/'/g, `''`) + \"'\";\n    });\n    return quotedValues.join(',');\n  }\n\n  interpolateVariablesInQueries(\n    queries: MssqlQueryForInterpolation[],\n    scopedVars: ScopedVars\n  ): MssqlQueryForInterpolation[] {\n    let expandedQueries = queries;\n    if (queries && queries.length > 0) {\n      expandedQueries = queries.map(query => {\n        const expandedQuery = {\n          ...query,\n          datasource: this.name,\n          rawSql: this.templateSrv.replace(query.rawSql, scopedVars, this.interpolateVariable),\n        };\n        return expandedQuery;\n      });\n    }\n    return expandedQueries;\n  }\n\n  query(options: any) {\n    const queries = _.filter(options.targets, item => {\n      return item.hide !== true;\n    }).map(item => {\n      return {\n        refId: item.refId,\n        intervalMs: options.intervalMs,\n        maxDataPoints: options.maxDataPoints,\n        datasourceId: this.id,\n        rawSql: this.templateSrv.replace(item.rawSql, options.scopedVars, this.interpolateVariable),\n        format: item.format,\n      };\n    });\n\n    if (queries.length === 0) {\n      return Promise.resolve({ data: [] });\n    }\n\n    return getBackendSrv()\n      .datasourceRequest({\n        url: '/api/tsdb/query',\n        method: 'POST',\n        data: {\n          from: options.range.from.valueOf().toString(),\n          to: options.range.to.valueOf().toString(),\n          queries: queries,\n        },\n      })\n      .then(this.responseParser.processQueryResult);\n  }\n\n  annotationQuery(options: any) {\n    if (!options.annotation.rawQuery) {\n      return Promise.reject({ message: 'Query missing in annotation definition' });\n    }\n\n    const query = {\n      refId: options.annotation.name,\n      datasourceId: this.id,\n      rawSql: this.templateSrv.replace(options.annotation.rawQuery, options.scopedVars, this.interpolateVariable),\n      format: 'table',\n    };\n\n    return getBackendSrv()\n      .datasourceRequest({\n        url: '/api/tsdb/query',\n        method: 'POST',\n        data: {\n          from: options.range.from.valueOf().toString(),\n          to: options.range.to.valueOf().toString(),\n          queries: [query],\n        },\n      })\n      .then((data: any) => this.responseParser.transformAnnotationResponse(options, data));\n  }\n\n  metricFindQuery(query: string, optionalOptions: { variable: { name: string } }) {\n    let refId = 'tempvar';\n    if (optionalOptions && optionalOptions.variable && optionalOptions.variable.name) {\n      refId = optionalOptions.variable.name;\n    }\n\n    const interpolatedQuery = {\n      refId: refId,\n      datasourceId: this.id,\n      rawSql: this.templateSrv.replace(query, {}, this.interpolateVariable),\n      format: 'table',\n    };\n\n    const range = this.timeSrv.timeRange();\n    const data = {\n      queries: [interpolatedQuery],\n      from: range.from.valueOf().toString(),\n      to: range.to.valueOf().toString(),\n    };\n\n    return getBackendSrv()\n      .datasourceRequest({\n        url: '/api/tsdb/query',\n        method: 'POST',\n        data: data,\n      })\n      .then((data: any) => this.responseParser.parseMetricFindQueryResult(refId, data));\n  }\n\n  testDatasource() {\n    return getBackendSrv()\n      .datasourceRequest({\n        url: '/api/tsdb/query',\n        method: 'POST',\n        data: {\n          from: '5m',\n          to: 'now',\n          queries: [\n            {\n              refId: 'A',\n              intervalMs: 1,\n              maxDataPoints: 1,\n              datasourceId: this.id,\n              rawSql: 'SELECT 1',\n              format: 'table',\n            },\n          ],\n        },\n      })\n      .then((res: any) => {\n        return { status: 'success', message: 'Database Connection OK' };\n      })\n      .catch((err: any) => {\n        console.log(err);\n        if (err.data && err.data.message) {\n          return { status: 'error', message: err.data.message };\n        } else {\n          return { status: 'error', message: err.status };\n        }\n      });\n  }\n\n  targetContainsTemplate(target: any) {\n    const rawSql = target.rawSql.replace('$__', '');\n    return this.templateSrv.variableExists(rawSql);\n  }\n}\n","import _ from 'lodash';\nimport { QueryCtrl } from 'app/plugins/sdk';\nimport { auto } from 'angular';\nimport { PanelEvents } from '@grafana/data';\n\nexport interface MssqlQuery {\n  refId: string;\n  format: string;\n  alias: string;\n  rawSql: string;\n}\n\nexport interface QueryMeta {\n  sql: string;\n}\n\nconst defaultQuery = `SELECT\n  $__timeEpoch(<time_column>),\n  <value column> as value,\n  <series name column> as metric\nFROM\n  <table name>\nWHERE\n  $__timeFilter(time_column)\nORDER BY\n  <time_column> ASC`;\n\nexport class MssqlQueryCtrl extends QueryCtrl {\n  static templateUrl = 'partials/query.editor.html';\n\n  showLastQuerySQL: boolean;\n  formats: any[];\n  target: MssqlQuery;\n  lastQueryMeta: QueryMeta;\n  lastQueryError: string;\n  showHelp: boolean;\n\n  /** @ngInject */\n  constructor($scope: any, $injector: auto.IInjectorService) {\n    super($scope, $injector);\n\n    this.target.format = this.target.format || 'time_series';\n    this.target.alias = '';\n    this.formats = [\n      { text: 'Time series', value: 'time_series' },\n      { text: 'Table', value: 'table' },\n    ];\n\n    if (!this.target.rawSql) {\n      // special handling when in table panel\n      if (this.panelCtrl.panel.type === 'table') {\n        this.target.format = 'table';\n        this.target.rawSql = 'SELECT 1';\n      } else {\n        this.target.rawSql = defaultQuery;\n      }\n    }\n\n    this.panelCtrl.events.on(PanelEvents.dataReceived, this.onDataReceived.bind(this), $scope);\n    this.panelCtrl.events.on(PanelEvents.dataError, this.onDataError.bind(this), $scope);\n  }\n\n  onDataReceived(dataList: any) {\n    this.lastQueryMeta = null;\n    this.lastQueryError = null;\n\n    const anySeriesFromQuery: any = _.find(dataList, { refId: this.target.refId });\n    if (anySeriesFromQuery) {\n      this.lastQueryMeta = anySeriesFromQuery.meta;\n    }\n  }\n\n  onDataError(err: any) {\n    if (err.data && err.data.results) {\n      const queryRes = err.data.results[this.target.refId];\n      if (queryRes) {\n        this.lastQueryMeta = queryRes.meta;\n        this.lastQueryError = queryRes.error;\n      }\n    }\n  }\n}\n","import {\n  createChangeHandler,\n  createResetHandler,\n  PasswordFieldEnum,\n} from '../../../features/datasources/utils/passwordHandlers';\n\nexport class MssqlConfigCtrl {\n  static templateUrl = 'partials/config.html';\n\n  current: any;\n  onPasswordReset: ReturnType<typeof createResetHandler>;\n  onPasswordChange: ReturnType<typeof createChangeHandler>;\n\n  /** @ngInject */\n  constructor($scope: any) {\n    this.current.jsonData.encrypt = this.current.jsonData.encrypt || 'false';\n    this.onPasswordReset = createResetHandler(this, PasswordFieldEnum.Password);\n    this.onPasswordChange = createChangeHandler(this, PasswordFieldEnum.Password);\n  }\n}\n","import { MssqlDatasource } from './datasource';\nimport { MssqlQueryCtrl } from './query_ctrl';\nimport { MssqlConfigCtrl } from './config_ctrl';\n\nconst defaultQuery = `SELECT\n    <time_column> as time,\n    <text_column> as text,\n    <tags_column> as tags\n  FROM\n    <table name>\n  WHERE\n    $__timeFilter(time_column)\n  ORDER BY\n    <time_column> ASC`;\n\nclass MssqlAnnotationsQueryCtrl {\n  static templateUrl = 'partials/annotations.editor.html';\n\n  annotation: any;\n\n  /** @ngInject */\n  constructor() {\n    this.annotation.rawQuery = this.annotation.rawQuery || defaultQuery;\n  }\n}\n\nexport {\n  MssqlDatasource,\n  MssqlDatasource as Datasource,\n  MssqlQueryCtrl as QueryCtrl,\n  MssqlConfigCtrl as ConfigCtrl,\n  MssqlAnnotationsQueryCtrl as AnnotationsQueryCtrl,\n};\n"],"sourceRoot":""}