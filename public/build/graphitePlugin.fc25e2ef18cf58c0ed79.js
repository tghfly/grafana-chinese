(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{nKVo:function(e,t,a){"use strict";a.r(t);var n=a("LvDl"),r=a.n(n),i=a("Obii");function s(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o=/^(\d+)(?:\.(\d+))?(?:\.(\d+))?(?:-([0-9A-Za-z\.]+))?/,u=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var a=o.exec(t);a&&(this.major=Number(a[1]),this.minor=Number(a[2]||0),this.patch=Number(a[3]||0),this.meta=a[4])}var t,a,n;return t=e,(a=[{key:"isGtOrEq",value:function(t){for(var a=new e(t),n=0;n<this.comparable.length;++n){if(this.comparable[n]>a.comparable[n])return!0;if(this.comparable[n]<a.comparable[n])return!1}return!0}},{key:"isValid",value:function(){return r.a.isNumber(this.major)}},{key:"comparable",get:function(){return[this.major,this.minor,this.patch]}}])&&s(t.prototype,a),n&&s(t,n),e}();function l(e,t){return new u(e).isGtOrEq(t)}function c(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var m={};function p(e){e.params=e.params||[],e.defaultParams=e.defaultParams||[],m[e.name]=e,e.shortName&&(m[e.shortName]=e)}var f=[{name:"other",type:"value_or_series",optional:!0,multiple:!0}];function h(e,t){return!e.version||l(t,e.version)}p({name:"scaleToSeconds",category:"Transform",params:[{name:"seconds",type:"int"}],defaultParams:[1]}),p({name:"perSecond",category:"Transform",params:[{name:"max value",type:"int",optional:!0}],defaultParams:[]}),p({name:"holtWintersForecast",category:"Calculate"}),p({name:"holtWintersConfidenceBands",category:"Calculate",params:[{name:"delta",type:"int"}],defaultParams:[3]}),p({name:"holtWintersAberration",category:"Calculate",params:[{name:"delta",type:"int"}],defaultParams:[3]}),p({name:"nPercentile",category:"Calculate",params:[{name:"Nth percentile",type:"int"}],defaultParams:[95]}),p({name:"diffSeries",params:f,defaultParams:["#A"],category:"Combine"}),p({name:"stddevSeries",params:f,defaultParams:[""],category:"Combine"}),p({name:"divideSeries",params:f,defaultParams:["#A"],category:"Combine"}),p({name:"multiplySeries",params:f,defaultParams:["#A"],category:"Combine"}),p({name:"asPercent",params:f,defaultParams:["#A"],category:"Combine"}),p({name:"group",params:f,defaultParams:["#A","#B"],category:"Combine"}),p({name:"sumSeries",shortName:"sum",category:"Combine",params:f,defaultParams:[""]}),p({name:"averageSeries",shortName:"avg",category:"Combine",params:f,defaultParams:[""]}),p({name:"rangeOfSeries",category:"Combine"}),p({name:"percentileOfSeries",category:"Combine",params:[{name:"n",type:"int"},{name:"interpolate",type:"boolean",options:["true","false"]}],defaultParams:[95,"false"]}),p({name:"sumSeriesWithWildcards",category:"Combine",params:[{name:"node",type:"int",multiple:!0}],defaultParams:[3]}),p({name:"maxSeries",shortName:"max",category:"Combine"}),p({name:"minSeries",shortName:"min",category:"Combine"}),p({name:"averageSeriesWithWildcards",category:"Combine",params:[{name:"node",type:"int",multiple:!0}],defaultParams:[3]}),p({name:"alias",category:"Alias",params:[{name:"alias",type:"string"}],defaultParams:["alias"]}),p({name:"aliasSub",category:"Alias",params:[{name:"search",type:"string"},{name:"replace",type:"string"}],defaultParams:["","\\1"]}),p({name:"consolidateBy",category:"Special",params:[{name:"function",type:"string",options:["sum","average","min","max"]}],defaultParams:["max"]}),p({name:"cumulative",category:"Special",params:[],defaultParams:[]}),p({name:"groupByNode",category:"Combine",params:[{name:"node",type:"int",options:[0,1,2,3,4,5,6,7,8,9,10,12]},{name:"function",type:"string",options:["sum","avg","maxSeries"]}],defaultParams:[3,"sum"]}),p({name:"aliasByNode",category:"Alias",params:[{name:"node",type:"int",options:[0,1,2,3,4,5,6,7,8,9,10,12],multiple:!0}],defaultParams:[3]}),p({name:"substr",category:"Special",params:[{name:"start",type:"int",options:[-6,-5,-4,-3,-2,-1,0,1,2,3,4,5,6,7,8,9,10,12]},{name:"stop",type:"int",options:[-6,-5,-4,-3,-2,-1,0,1,2,3,4,5,6,7,8,9,10,12]}],defaultParams:[0,0]}),p({name:"sortByName",category:"Sorting",params:[{name:"natural",type:"boolean",options:["true","false"],optional:!0}],defaultParams:["false"]}),p({name:"sortByMaxima",category:"Sorting"}),p({name:"sortByMinima",category:"Sorting"}),p({name:"sortByTotal",category:"Sorting"}),p({name:"aliasByMetric",category:"Alias"}),p({name:"randomWalk",fake:!0,category:"Special",params:[{name:"name",type:"string"}],defaultParams:["randomWalk"]}),p({name:"countSeries",category:"Combine"}),p({name:"constantLine",category:"Special",params:[{name:"value",type:"int"}],defaultParams:[10]}),p({name:"cactiStyle",category:"Special"}),p({name:"keepLastValue",category:"Transform",params:[{name:"n",type:"int"}],defaultParams:[100]}),p({name:"changed",category:"Special",params:[],defaultParams:[]}),p({name:"scale",category:"Transform",params:[{name:"factor",type:"int"}],defaultParams:[1]}),p({name:"offset",category:"Transform",params:[{name:"amount",type:"int"}],defaultParams:[10]}),p({name:"transformNull",category:"Transform",params:[{name:"amount",type:"int"}],defaultParams:[0]}),p({name:"integral",category:"Transform"}),p({name:"derivative",category:"Transform"}),p({name:"nonNegativeDerivative",category:"Transform",params:[{name:"max value or 0",type:"int",optional:!0}],defaultParams:[""]}),p({name:"timeShift",category:"Transform",params:[{name:"amount",type:"select",options:["1h","6h","12h","1d","2d","7d","14d","30d"]}],defaultParams:["1d"]}),p({name:"timeStack",category:"Transform",params:[{name:"timeShiftUnit",type:"select",options:["1h","6h","12h","1d","2d","7d","14d","30d"]},{name:"timeShiftStart",type:"int"},{name:"timeShiftEnd",type:"int"}],defaultParams:["1d",0,7]}),p({name:"summarize",category:"Transform",params:[{name:"interval",type:"string"},{name:"func",type:"select",options:["sum","avg","min","max","last"]},{name:"alignToFrom",type:"boolean",optional:!0,options:["false","true"]}],defaultParams:["1h","sum","false"]}),p({name:"smartSummarize",category:"Transform",params:[{name:"interval",type:"string"},{name:"func",type:"select",options:["sum","avg","min","max","last"]}],defaultParams:["1h","sum"]}),p({name:"absolute",category:"Transform"}),p({name:"hitcount",category:"Transform",params:[{name:"interval",type:"string"}],defaultParams:["10s"]}),p({name:"log",category:"Transform",params:[{name:"base",type:"int"}],defaultParams:["10"]}),p({name:"averageAbove",category:"Filter Series",params:[{name:"n",type:"int"}],defaultParams:[25]}),p({name:"averageBelow",category:"Filter Series",params:[{name:"n",type:"int"}],defaultParams:[25]}),p({name:"currentAbove",category:"Filter Series",params:[{name:"n",type:"int"}],defaultParams:[25]}),p({name:"currentBelow",category:"Filter Series",params:[{name:"n",type:"int"}],defaultParams:[25]}),p({name:"maximumAbove",category:"Filter Series",params:[{name:"value",type:"int"}],defaultParams:[0]}),p({name:"maximumBelow",category:"Filter Series",params:[{name:"value",type:"int"}],defaultParams:[0]}),p({name:"minimumAbove",category:"Filter Series",params:[{name:"value",type:"int"}],defaultParams:[0]}),p({name:"minimumBelow",category:"Filter Series",params:[{name:"value",type:"int"}],defaultParams:[0]}),p({name:"limit",category:"Filter Series",params:[{name:"n",type:"int"}],defaultParams:[5]}),p({name:"mostDeviant",category:"Filter Series",params:[{name:"n",type:"int"}],defaultParams:[10]}),p({name:"exclude",category:"Filter Series",params:[{name:"exclude",type:"string"}],defaultParams:["exclude"]}),p({name:"highestCurrent",category:"Filter Series",params:[{name:"count",type:"int"}],defaultParams:[5]}),p({name:"highestMax",category:"Filter Series",params:[{name:"count",type:"int"}],defaultParams:[5]}),p({name:"lowestCurrent",category:"Filter Series",params:[{name:"count",type:"int"}],defaultParams:[5]}),p({name:"movingAverage",category:"Calculate",params:[{name:"windowSize",type:"int_or_interval",options:["5","7","10","5min","10min","30min","1hour"]}],defaultParams:[10]}),p({name:"movingMedian",category:"Calculate",params:[{name:"windowSize",type:"int_or_interval",options:["5","7","10","5min","10min","30min","1hour"]}],defaultParams:["5"]}),p({name:"stdev",category:"Calculate",params:[{name:"n",type:"int"},{name:"tolerance",type:"int"}],defaultParams:[5,.1]}),p({name:"highestAverage",category:"Filter Series",params:[{name:"count",type:"int"}],defaultParams:[5]}),p({name:"lowestAverage",category:"Filter Series",params:[{name:"count",type:"int"}],defaultParams:[5]}),p({name:"removeAbovePercentile",category:"Filter Data",params:[{name:"n",type:"int"}],defaultParams:[5]}),p({name:"removeAboveValue",category:"Filter Data",params:[{name:"n",type:"int"}],defaultParams:[5]}),p({name:"removeBelowPercentile",category:"Filter Data",params:[{name:"n",type:"int"}],defaultParams:[5]}),p({name:"removeBelowValue",category:"Filter Data",params:[{name:"n",type:"int"}],defaultParams:[5]}),p({name:"useSeriesAbove",category:"Filter Series",params:[{name:"value",type:"int"},{name:"search",type:"string"},{name:"replace",type:"string"}],defaultParams:[0,"search","replace"]}),p({name:"aggregateLine",category:"Calculate",params:[{name:"func",type:"select",options:["sum","avg","min","max","last"]}],defaultParams:["avg"],version:"1.0"}),p({name:"averageOutsidePercentile",category:"Filter Series",params:[{name:"n",type:"int"}],defaultParams:[95],version:"1.0"}),p({name:"delay",category:"Transform",params:[{name:"steps",type:"int"}],defaultParams:[1],version:"1.0"}),p({name:"exponentialMovingAverage",category:"Calculate",params:[{name:"windowSize",type:"int_or_interval",options:["5","7","10","5min","10min","30min","1hour"]}],defaultParams:[10],version:"1.0"}),p({name:"fallbackSeries",category:"Special",params:[{name:"fallback",type:"string"}],defaultParams:["constantLine(0)"],version:"1.0"}),p({name:"grep",category:"Filter Series",params:[{name:"grep",type:"string"}],defaultParams:["grep"],version:"1.0"}),p({name:"groupByNodes",category:"Combine",params:[{name:"function",type:"string",options:["sum","avg","maxSeries"]},{name:"node",type:"int",options:[0,1,2,3,4,5,6,7,8,9,10,12],multiple:!0}],defaultParams:["sum",3],version:"1.0"}),p({name:"integralByInterval",category:"Transform",params:[{name:"intervalUnit",type:"select",options:["1h","6h","12h","1d","2d","7d","14d","30d"]}],defaultParams:["1d"],version:"1.0"}),p({name:"interpolate",category:"Transform",params:[{name:"limit",type:"int",optional:!0}],defaultParams:[],version:"1.0"}),p({name:"invert",category:"Transform",version:"1.0"}),p({name:"isNonNull",category:"Combine",version:"1.0"}),p({name:"linearRegression",category:"Calculate",params:[{name:"startSourceAt",type:"select",options:["-1h","-6h","-12h","-1d","-2d","-7d","-14d","-30d"],optional:!0},{name:"endSourceAt",type:"select",options:["-1h","-6h","-12h","-1d","-2d","-7d","-14d","-30d"],optional:!0}],defaultParams:[],version:"1.0"}),p({name:"mapSeries",shortName:"map",params:[{name:"node",type:"int"}],defaultParams:[3],category:"Combine",version:"1.0"}),p({name:"movingMin",category:"Calculate",params:[{name:"windowSize",type:"int_or_interval",options:["5","7","10","5min","10min","30min","1hour"]}],defaultParams:[10],version:"1.0"}),p({name:"movingMax",category:"Calculate",params:[{name:"windowSize",type:"int_or_interval",options:["5","7","10","5min","10min","30min","1hour"]}],defaultParams:[10],version:"1.0"}),p({name:"movingSum",category:"Calculate",params:[{name:"windowSize",type:"int_or_interval",options:["5","7","10","5min","10min","30min","1hour"]}],defaultParams:[10],version:"1.0"}),p({name:"multiplySeriesWithWildcards",category:"Combine",params:[{name:"position",type:"int",options:[0,1,2,3,4,5,6,7,8,9,10,12],multiple:!0}],defaultParams:[2],version:"1.0"}),p({name:"offsetToZero",category:"Transform",version:"1.0"}),p({name:"pow",category:"Transform",params:[{name:"factor",type:"int"}],defaultParams:[10],version:"1.0"}),p({name:"powSeries",category:"Transform",params:f,defaultParams:[""],version:"1.0"}),p({name:"reduceSeries",shortName:"reduce",params:[{name:"function",type:"string",options:["asPercent","diffSeries","divideSeries"]},{name:"reduceNode",type:"int",options:[0,1,2,3,4,5,6,7,8,9,10,11,12,13]},{name:"reduceMatchers",type:"string",multiple:!0}],defaultParams:["asPercent",2,"used_bytes"],category:"Combine",version:"1.0"}),p({name:"removeBetweenPercentile",category:"Filter Series",params:[{name:"n",type:"int"}],defaultParams:[95],version:"1.0"}),p({name:"removeEmptySeries",category:"Filter Series",version:"1.0"}),p({name:"squareRoot",category:"Transform",version:"1.0"}),p({name:"timeSlice",category:"Transform",params:[{name:"startSliceAt",type:"select",options:["-1h","-6h","-12h","-1d","-2d","-7d","-14d","-30d"]},{name:"endSliceAt",type:"select",options:["-1h","-6h","-12h","-1d","-2d","-7d","-14d","-30d"],optional:!0}],defaultParams:["-1h"],version:"1.0"}),p({name:"weightedAverage",category:"Combine",params:[{name:"other",type:"value_or_series",optional:!0},{name:"node",type:"int",options:[0,1,2,3,4,5,6,7,8,9,10,12]}],defaultParams:["#A",4],version:"1.0"}),p({name:"seriesByTag",category:"Special",params:[{name:"tagExpression",type:"string",multiple:!0}],version:"1.1"}),p({name:"groupByTags",category:"Combine",params:[{name:"function",type:"string",options:["sum","avg","maxSeries"]},{name:"tag",type:"string",multiple:!0}],defaultParams:["sum","tag"],version:"1.1"}),p({name:"aliasByTags",category:"Alias",params:[{name:"tag",type:"string",multiple:!0}],defaultParams:["tag"],version:"1.1"});var g=function(){function e(t,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.def=t,this.params=[],a&&a.withDefaultParams&&(this.params=t.defaultParams.slice(0)),this.updateText()}var t,a,n;return t=e,(a=[{key:"render",value:function(e,t){for(var a=this,n=this.def.name+"(",i=r.a.map(this.params,(function(e,n){var i;if(n<a.def.params.length?i=a.def.params[n].type:r.a.get(r.a.last(a.def.params),"multiple")&&(i=r.a.get(r.a.last(a.def.params),"type")),r.a.includes(["value_or_series","boolean","int","float","node"],i))return e;var s=r.a.isString(e)?t(e):e;return r.a.includes(["int_or_interval","node_or_tag"],i)&&r.a.isFinite(+s)?r.a.toString(e):"'"+e+"'"}));""===i[i.length-1];)i.pop();return e&&i.unshift(e),n+i.join(", ")+")"}},{key:"_hasMultipleParamsInString",value:function(e,t){return!!(-1!==e.indexOf(",")&&(this.def.params[t+1]&&this.def.params[t+1].optional||t+1>=this.def.params.length&&r.a.get(r.a.last(this.def.params),"multiple")))}},{key:"updateParam",value:function(e,t){var a=this;this._hasMultipleParamsInString(e,t)?r.a.each(e.split(","),(function(e,n){a.updateParam(e.trim(),t+n)})):(""===e&&(t>=this.def.params.length||this.def.params[t].optional)?this.params.splice(t,1):this.params[t]=e,this.updateText())}},{key:"updateText",value:function(){if(0!==this.params.length){var e=this.def.name+"(";e+=this.params.join(", "),e+=")",this.text=e}else this.text=this.def.name+"()"}}])&&c(t.prototype,a),n&&c(t,n),e}();function d(e,t){if(!(t||m)[e])throw{message:"Method not found "+e};return(t||m)[e]}var y,v={createFuncInstance:function(e,t,a){return r.a.isString(e)&&(e=d(e,a)),new g(e,t)},getFuncDef:d,getFuncDefs:function(e,t){var a={};return r.a.forEach(t||m,(function(t){h(t,e)&&(a[t.name]=r.a.assign({},t,{params:r.a.filter(t.params,(function(t){return h(t,e)}))}))})),a},parseFuncDefs:function(e){var t={};return r.a.forEach(e||{},(function(e,a){if("Graph"!==e.group){var n=e.description;n&&(n=n.replace(/:py:func:`(.+)( <[^>]*>)?`/g,"``$1``").replace(/.. seealso:: /g,"See also: ").replace(/.. code-block *:: *none/g,".. code-block::"));var i={name:e.name,description:n,category:e.group,params:[],defaultParams:[],fake:!1};/^seriesLists?$/.test(r.a.get(e,"params[0].type",""))?e.params[0].multiple?e.params[0].required=!1:e.params.shift():i.fake=!0,r.a.forEach(e.params,(function(e){var t={name:e.name,type:"string",optional:!e.required,multiple:!!e.multiple,options:void 0};void 0!==e.default?i.defaultParams.push(r.a.toString(e.default)):e.suggestions?i.defaultParams.push(r.a.toString(e.suggestions[0])):i.defaultParams.push(""),"boolean"===e.type?(t.type="boolean",t.options=["true","false"]):"integer"===e.type?t.type="int":"float"===e.type?t.type="float":"node"===e.type?(t.type="node",t.options=["0","1","2","3","4","5","6","7","8","9","10","11","12"]):"nodeOrTag"===e.type?(t.type="node_or_tag",t.options=["name","0","1","2","3","4","5","6","7","8","9","10","11","12"]):"intOrInterval"===e.type?t.type="int_or_interval":"seriesList"===e.type&&(t.type="value_or_series"),e.options?t.options=r.a.map(e.options,r.a.toString):e.suggestions&&(t.options=r.a.map(e.suggestions,r.a.toString)),i.params.push(t)})),t[a]=i}})),t}},b=a("t8hP");!function(e){e.Default="default",e.Metrictank="metrictank"}(y||(y={}));var k=a("4qJB");function S(e){return(S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function T(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function P(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function w(e,t,a,n,r,i,s){try{var o=e[i](s),u=o.value}catch(e){return void a(e)}o.done?t(u):Promise.resolve(u).then(n,r)}function x(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function C(e,t){return!t||"object"!==S(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function O(e){return(O=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function E(e,t){return(E=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var F=function(e){function t(e,a){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=C(this,O(t).call(this,e))).templateSrv=a,n.funcDefs=null,n.funcDefsPromise=null,n.convertResponseToDataFrames=function(e){var t=[];if(!e||!e.data)return{data:t};var a=e.data.series||e.data;if(!r.a.isArray(a))throw{message:"Missing series in result",data:e};for(var n=0;n<a.length;n++){for(var s=a[n],o=0;o<s.datapoints.length;o++)s.datapoints[o][1]*=1e3;var u=Object(i.toDataFrame)(s);s.meta&&(u.meta={custom:{request:e.data.meta,info:s.meta}}),t.push(u)}return{data:t}},n.basicAuth=e.basicAuth,n.url=e.url,n.name=e.name,n.graphiteVersion=e.jsonData.graphiteVersion||"0.9",n.isMetricTank=e.jsonData.graphiteType===y.Metrictank,n.supportsTags=l(n.graphiteVersion,"1.1"),n.cacheTimeout=e.cacheTimeout,n.withCredentials=e.withCredentials,n.funcDefs=null,n.funcDefsPromise=null,n._seriesRefLetters="ABCDEFGHIJKLMNOPQRSTUVWXYZ",n}var a,n,s,o,c;return t.$inject=["instanceSettings","templateSrv"],function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&E(e,t)}(t,e),a=t,(n=[{key:"getQueryOptionsInfo",value:function(){return{maxDataPoints:!0,cacheTimeout:!0,links:[{text:"Help",url:"http://docs.grafana.org/features/datasources/graphite/#using-graphite-in-grafana"}]}}},{key:"query",value:(o=regeneratorRuntime.mark((function e(t){var a,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a={from:this.translateTime(t.rangeRaw.from,!1,t.timezone),until:this.translateTime(t.rangeRaw.to,!0,t.timezone),targets:t.targets,format:t.format,cacheTimeout:t.cacheTimeout||this.cacheTimeout,maxDataPoints:t.maxDataPoints},0!==(n=this.buildGraphiteParams(a,t.scopedVars)).length){e.next=4;break}return e.abrupt("return",Promise.resolve({data:[]}));case 4:return this.isMetricTank&&n.push("meta=true"),r={method:"POST",url:"/render",data:n.join("&"),headers:{"Content-Type":"application/x-www-form-urlencoded"}},this.addTracingHeaders(r,t),t.panelId&&(r.requestId=this.name+".panelId."+t.panelId),e.abrupt("return",this.doGraphiteRequest(r).then(this.convertResponseToDataFrames));case 9:case"end":return e.stop()}}),e,this)})),c=function(){var e=this,t=arguments;return new Promise((function(a,n){var r=o.apply(e,t);function i(e){w(r,a,n,i,s,"next",e)}function s(e){w(r,a,n,i,s,"throw",e)}i(void 0)}))},function(e){return c.apply(this,arguments)})},{key:"addTracingHeaders",value:function(e,t){!this.url.match(/^http/)&&(e.headers["X-Dashboard-Id"]=t.dashboardId,e.headers["X-Panel-Id"]=t.panelId)}},{key:"parseTags",value:function(e){var t=[];return 1===(t=e.split(",")).length&&""===(t=e.split(" "))[0]&&(t=[]),t}},{key:"interpolateVariablesInQueries",value:function(e,t){var a=this,n=e;return e&&e.length>0&&(n=e.map((function(e){return function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?T(Object(a),!0).forEach((function(t){P(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):T(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},e,{datasource:a.name,target:a.templateSrv.replace(e.target,t)})}))),n}},{key:"annotationQuery",value:function(e){var t=this;if(e.annotation.target){var a=this.templateSrv.replace(e.annotation.target,{},"glob"),n={rangeRaw:e.rangeRaw,targets:[{target:a}],format:"json",maxDataPoints:100};return this.query(n).then((function(t){for(var a=[],n=0;n<t.data.length;n++)for(var r=t.data[n],i=0;i<r.length;i++){var s=r.fields[1].values.get(i);r.fields[0].values.get(i)&&a.push({annotation:e.annotation,time:s,title:r.name})}return a}))}var i=this.templateSrv.replace(e.annotation.tags);return this.events({range:e.rangeRaw,tags:i}).then((function(a){for(var n=[],i=0;i<a.data.length;i++){var s=a.data[i],o=s.tags;r.a.isString(s.tags)&&(o=t.parseTags(s.tags)),n.push({annotation:e.annotation,time:1e3*s.when,title:s.what,tags:o,text:s.data})}return n}))}},{key:"events",value:function(e){try{var t="";return e.tags&&(t="&tags="+e.tags),this.doGraphiteRequest({method:"GET",url:"/events/get_data?from="+this.translateTime(e.range.from,!1,e.timezone)+"&until="+this.translateTime(e.range.to,!0,e.timezone)+t})}catch(e){return Promise.reject(e)}}},{key:"targetContainsTemplate",value:function(e){return this.templateSrv.variableExists(e.target)}},{key:"translateTime",value:function(e,t,a){if(r.a.isString(e)){if("now"===e)return"now";if(e.indexOf("now-")>=0&&-1===e.indexOf("/"))return e=(e=(e=e.substring(3)).replace("m","min")).replace("M","mon");e=i.dateMath.parse(e,t,a)}return t?e.get("s")&&e.add(1,"s"):!1===t&&e.get("s")&&e.subtract(1,"s"),e.unix()}},{key:"metricFindQuery",value:function(e,t){var a=t||{},n=this.templateSrv.replace(e,Object(k.g)({query:e,wildcardChar:"",options:t})),i=n.match(/^tag_values\(([^,]+)((, *[^,]+)*)\)$/);if(i){for(var s=[],o=/, *([^,]+)/g,u=o.exec(i[2]);null!==u;)s.push(u[1]),u=o.exec(i[2]);return a.limit=1e4,this.getTagValuesAutoComplete(s,i[1],void 0,a)}if(i=n.match(/^tags\(([^,]*)((, *[^,]+)*)\)$/)){var l=[];if(i[1]){l.push(i[1]);for(var c=/, *([^,]+)/g,m=c.exec(i[2]);null!==m;)l.push(m[1]),m=c.exec(i[2])}return a.limit=1e4,this.getTagsAutoComplete(l,void 0,a)}n=this.templateSrv.replace(e,Object(k.g)({query:e,wildcardChar:"*",options:t}));var p={method:"POST",url:"/metrics/find",params:{},data:"query=".concat(n),headers:{"Content-Type":"application/x-www-form-urlencoded"},requestId:a.requestId};return a.range&&(p.params.from=this.translateTime(a.range.from,!1,a.timezone),p.params.until=this.translateTime(a.range.to,!0,a.timezone)),this.doGraphiteRequest(p).then((function(e){return r.a.map(e.data,(function(e){return{text:e.text,expandable:!!e.expandable}}))}))}},{key:"getTags",value:function(e){var t=e||{},a={method:"GET",url:"/tags",requestId:t.requestId};return t.range&&(a.params.from=this.translateTime(t.range.from,!1,t.timezone),a.params.until=this.translateTime(t.range.to,!0,t.timezone)),this.doGraphiteRequest(a).then((function(e){return r.a.map(e.data,(function(e){return{text:e.tag,id:e.id}}))}))}},{key:"getTagValues",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={method:"GET",url:"/tags/"+this.templateSrv.replace(e.key),requestId:e.requestId};return e.range&&(t.params.from=this.translateTime(e.range.from,!1,e.timezone),t.params.until=this.translateTime(e.range.to,!0,e.timezone)),this.doGraphiteRequest(t).then((function(e){return e.data&&e.data.values?r.a.map(e.data.values,(function(e){return{text:e.value,id:e.id}})):[]}))}},{key:"getTagsAutoComplete",value:function(e,t,a){var n=this,i=a||{},s={method:"GET",url:"/tags/autoComplete/tags",params:{expr:r.a.map(e,(function(e){return n.templateSrv.replace((e||"").trim())}))},requestId:i.requestId};return t&&(s.params.tagPrefix=t),i.limit&&(s.params.limit=i.limit),i.range&&(s.params.from=this.translateTime(i.range.from,!1,i.timezone),s.params.until=this.translateTime(i.range.to,!0,i.timezone)),this.doGraphiteRequest(s).then((function(e){return e.data?r.a.map(e.data,(function(e){return{text:e}})):[]}))}},{key:"getTagValuesAutoComplete",value:function(e,t,a,n){var i=this,s=n||{},o={method:"GET",url:"/tags/autoComplete/values",params:{expr:r.a.map(e,(function(e){return i.templateSrv.replace((e||"").trim())})),tag:this.templateSrv.replace((t||"").trim())},requestId:s.requestId};return a&&(o.params.valuePrefix=a),s.limit&&(o.params.limit=s.limit),s.range&&(o.params.from=this.translateTime(s.range.from,!1,s.timezone),o.params.until=this.translateTime(s.range.to,!0,s.timezone)),this.doGraphiteRequest(o).then((function(e){return e.data?r.a.map(e.data,(function(e){return{text:e}})):[]}))}},{key:"getVersion",value:function(e){var t={method:"GET",url:"/version",requestId:(e||{}).requestId};return this.doGraphiteRequest(t).then((function(e){return e.data&&new u(e.data).isValid()?e.data:""})).catch((function(){return""}))}},{key:"createFuncInstance",value:function(e,t){return v.createFuncInstance(e,t,this.funcDefs)}},{key:"getFuncDef",value:function(e){return v.getFuncDef(e,this.funcDefs)}},{key:"waitForFuncDefsLoaded",value:function(){return this.getFuncDefs()}},{key:"getFuncDefs",value:function(){var e=this;return null!==this.funcDefsPromise?this.funcDefsPromise:l(this.graphiteVersion,"1.1")?(this.funcDefsPromise=this.doGraphiteRequest({method:"GET",url:"/functions"}).then((function(t){return 200!==t.status||"object"!==S(t.data)?e.funcDefs=v.getFuncDefs(e.graphiteVersion):e.funcDefs=v.parseFuncDefs(t.data),e.funcDefs})).catch((function(t){return console.log("Fetching graphite functions error",t),e.funcDefs=v.getFuncDefs(e.graphiteVersion),e.funcDefs})),this.funcDefsPromise):(this.funcDefs=v.getFuncDefs(this.graphiteVersion),this.funcDefsPromise=Promise.resolve(this.funcDefs),this.funcDefsPromise)}},{key:"testDatasource",value:function(){return this.query({panelId:3,rangeRaw:{from:"now-1h",to:"now"},targets:[{target:"constantLine(100)"}],maxDataPoints:300}).then((function(){return{status:"success",message:"Data source is working"}}))}},{key:"doGraphiteRequest",value:function(e){return(this.basicAuth||this.withCredentials)&&(e.withCredentials=!0),this.basicAuth&&(e.headers=e.headers||{},e.headers.Authorization=this.basicAuth),e.url=this.url+e.url,e.inspect={type:"graphite"},Object(b.getBackendSrv)().datasourceRequest(e)}},{key:"buildGraphiteParams",value:function(e,t){var a,n,i,s=["from","until","rawData","format","maxDataPoints","cacheTimeout"],o=[],u={},l=/\#([A-Z])/g,c=/'(\d+)m'/gi,m=!1;function p(e){return e.replace("m","min").replace("M","mon")}for(e.format="json",i=0;i<e.targets.length;i++)(a=e.targets[i]).target&&(a.refId||(a.refId=this._seriesRefLetters[i]),n=(n=this.templateSrv.replace(a.target,t)).replace(c,p),u[a.refId]=n);function f(e,t){return u[t]||e}for(i=0;i<e.targets.length;i++)(a=e.targets[i]).target&&(n=(n=u[a.refId]).replace(l,f),u[a.refId]=n,a.hide||(m=!0,o.push("target="+encodeURIComponent(n))));return r.a.each(e,(function(e,t){-1!==r.a.indexOf(s,t)&&e&&o.push(t+"="+encodeURIComponent(e))})),m?o:[]}}])&&x(a.prototype,n),s&&x(a,s),t}(i.DataSourceApi);var M=a("+2Rf"),q=a.n(M),_=a("XI+/"),j=a.n(_),A=a("txxJ");function D(e,t,a,n,r,i,s){try{var o=e[i](s),u=o.value}catch(e){return void a(e)}o.done?t(u):Promise.resolve(u).then(n,r)}function I(e){return function(){var t=this,a=arguments;return new Promise((function(n,r){var i=e.apply(t,a);function s(e){D(i,n,r,s,o,"next",e)}function o(e){D(i,n,r,s,o,"throw",e)}s(void 0)}))}}function B(e){return{link:function(t,n){var i,s=this,o=t.ctrl,u=q()('<input type="text" class="gf-form-input" spellcheck="false" style="display:none"></input>'),l=q()('<a class="gf-form-label query-part dropdown-toggle" tabindex="1" gf-dropdown="functionMenu" data-toggle="dropdown"><i class="fa fa-plus"></i></a>');u.appendTo(n),l.appendTo(n),o.datasource.getFuncDefs().then((function(a){var i=r.a.map(a,"name").sort();t.functionMenu=function(e){var t={};return r.a.forEach(e,(function(e){e.category&&(t[e.category]||(t[e.category]=[]),t[e.category].push({text:e.name,click:"ctrl.addFunction('"+e.name+"')"}))})),r.a.sortBy(r.a.map(t,(function(e,t){return{text:t,submenu:r.a.sortBy(e,"text")}})),"text")}(a),u.attr("data-provide","typeahead"),u.typeahead({source:i,minLength:1,items:10,updater:function(e){var a=o.datasource.getFuncDef(e);return a||(e=e.toLowerCase(),a=r.a.find(i,(function(t){return 0===t.toLowerCase().indexOf(e)})))?(t.$apply((function(){o.addFunction(a)})),u.trigger("blur"),""):""}}),l.click((function(){l.hide(),u.show(),u.focus()})),u.keyup((function(){n.toggleClass("open",""===u.val())})),u.blur((function(){setTimeout((function(){u.val(""),u.hide(),l.show(),n.removeClass("open")}),200)})),e(n.contents())(t)}));var c=function(){i&&(i.destroy(),i=null)};q()(n).on("mouseenter","ul.dropdown-menu li",I(regeneratorRuntime.mark((function e(){var t,n,r,u,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c();try{t=o.datasource.getFuncDef(q()("a",s).text())}catch(e){}if(!t||!t.description){e.next=12;break}return(n=t.description).length>500&&(n=n.substring(0,497)+"..."),r=document.createElement("div"),e.next=8,a.e(48).then(a.t.bind(null,"fQim",7));case 8:u=e.sent,l=u.default,r.innerHTML="<h4>"+t.name+"</h4>"+l(n),i=new j.a({target:s,content:r,classes:"drop-popover",openOn:"always",tetherOptions:{attachment:"bottom left",targetAttachment:"bottom right"}});case 12:case"end":return e.stop()}}),e)})))).on("mouseout","ul.dropdown-menu li",(function(){c()})),t.$on("$destroy",c)}}}function R(e,t){return{restrict:"A",link:function(a,n){var i=q()('\n    <function-editor\n      func="func"\n      onRemove="ctrl.handleRemoveFunction"\n      onMoveLeft="ctrl.handleMoveLeft"\n      onMoveRight="ctrl.handleMoveRight"\n    /><span>(</span>\n  '),s=a.ctrl,o=a.func,u=!1,l=0,c=null;function m(e){var t=q()(this),a=t.prev(".comma"),n=t.next();n.val(o.params[e]),a.removeClass("query-part__last"),t.hide(),n.show(),n.focus(),n.select();var r=n.data("typeahead");r&&(n.val(""),r.lookup())}function p(e){return e<o.def.params.length?o.def.params[e]:r.a.last(o.def.params).multiple?r.a.assign({},r.a.last(o.def.params),{optional:!0}):{}}function f(e,n){var r=q()(e);clearTimeout(c),c=null;var i=r.prev(),m=i.prev(".comma"),f=r.val();(""!==f||p(n).optional)&&(o.updateParam(f,n),i.html(f?t.highlightVariablesAsHtml(f):"&nbsp;")),l!==o.params.length&&(u||(u=!0,setTimeout((function(){v(),u=!1}),200))),a.$apply((function(){s.targetChanged()})),i.hasClass("query-part__last")&&""===f?m.addClass("query-part__last"):i.removeClass("query-part__last"),r.hide(),i.show()}function h(e){var t=this;c=setTimeout((function(){f(t,e)}),200)}function g(e,t){13===t.which&&q()(this).blur()}function d(){this.style.width=8*(3+this.value.length)+"px"}function y(){i.appendTo(n);for(var s=r.a.clone(o.def.params),u=r.a.last(o.def.params);o.params.length>=s.length&&u&&u.multiple;)s.push(r.a.assign({},u,{optional:!0}));r.a.each(s,(function(e,a){if(e.optional&&o.params.length<a)return!1;var i=t.highlightVariablesAsHtml(o.params[a]),s=null!=i&&""!==i,u=a>=o.params.length-1&&e.optional&&!s,c="query-part__link";u&&(c+=" query-part__last"),u&&e.multiple?i="+":s||(i=e.name,c+=" query-part__link--no-value"),a>0&&q()('<span class="comma'+(u?" query-part__last":"")+'">, </span>').appendTo(n);var y=q()('<a ng-click="" class="'.concat(c,'">').concat(i,"</a>")),v=q()('<input type="text" style="display:none" class="input-small tight-form-func-param"></input>');return v.attr("placeholder",e.name),l++,y.appendTo(n),v.appendTo(n),v.blur(r.a.partial(h,a)),v.keyup(d),v.keypress(r.a.partial(g,a)),y.click(r.a.partial(m,a)),e.options&&function(e,t){e.attr("data-provide","typeahead");var a=p(t).options;"int"===p(t).type&&(a=r.a.map(a,(function(e){return e.toString()}))),e.typeahead({source:a,minLength:0,items:20,updater:function(a){return e.val(a),f(e[0],t),a}}),e.data("typeahead").lookup=function(){return this.query=this.$element.val()||"",this.process(this.source)}}(v,a),!0})),q()("<span>)</span>").appendTo(n),e(n.contents())(a)}function v(){n.children().remove(),y(),a.func.added&&(a.func.added=!1,setTimeout((function(){n.find(".query-part__link").first().click()}),10))}s.handleRemoveFunction=function(e){s.removeFunction(e)},s.handleMoveLeft=function(e){s.moveFunction(e,-1)},s.handleMoveRight=function(e){s.moveFunction(e,1)},v()}}}function N(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}B.$inject=["$compile"],A.c.directive("graphiteAddFunc",B),R.$inject=["$compile","templateSrv"],A.c.directive("graphiteFuncEditor",R);for(var V=[170,170,181,181,186,186,192,214,216,246,248,705,710,721,736,740,748,748,750,750,880,884,886,887,890,893,902,902,904,906,908,908,910,929,931,1013,1015,1153,1162,1319,1329,1366,1369,1369,1377,1415,1488,1514,1520,1522,1568,1610,1646,1647,1649,1747,1749,1749,1765,1766,1774,1775,1786,1788,1791,1791,1808,1808,1810,1839,1869,1957,1969,1969,1994,2026,2036,2037,2042,2042,2048,2069,2074,2074,2084,2084,2088,2088,2112,2136,2308,2361,2365,2365,2384,2384,2392,2401,2417,2423,2425,2431,2437,2444,2447,2448,2451,2472,2474,2480,2482,2482,2486,2489,2493,2493,2510,2510,2524,2525,2527,2529,2544,2545,2565,2570,2575,2576,2579,2600,2602,2608,2610,2611,2613,2614,2616,2617,2649,2652,2654,2654,2674,2676,2693,2701,2703,2705,2707,2728,2730,2736,2738,2739,2741,2745,2749,2749,2768,2768,2784,2785,2821,2828,2831,2832,2835,2856,2858,2864,2866,2867,2869,2873,2877,2877,2908,2909,2911,2913,2929,2929,2947,2947,2949,2954,2958,2960,2962,2965,2969,2970,2972,2972,2974,2975,2979,2980,2984,2986,2990,3001,3024,3024,3077,3084,3086,3088,3090,3112,3114,3123,3125,3129,3133,3133,3160,3161,3168,3169,3205,3212,3214,3216,3218,3240,3242,3251,3253,3257,3261,3261,3294,3294,3296,3297,3313,3314,3333,3340,3342,3344,3346,3386,3389,3389,3406,3406,3424,3425,3450,3455,3461,3478,3482,3505,3507,3515,3517,3517,3520,3526,3585,3632,3634,3635,3648,3654,3713,3714,3716,3716,3719,3720,3722,3722,3725,3725,3732,3735,3737,3743,3745,3747,3749,3749,3751,3751,3754,3755,3757,3760,3762,3763,3773,3773,3776,3780,3782,3782,3804,3805,3840,3840,3904,3911,3913,3948,3976,3980,4096,4138,4159,4159,4176,4181,4186,4189,4193,4193,4197,4198,4206,4208,4213,4225,4238,4238,4256,4293,4304,4346,4348,4348,4352,4680,4682,4685,4688,4694,4696,4696,4698,4701,4704,4744,4746,4749,4752,4784,4786,4789,4792,4798,4800,4800,4802,4805,4808,4822,4824,4880,4882,4885,4888,4954,4992,5007,5024,5108,5121,5740,5743,5759,5761,5786,5792,5866,5870,5872,5888,5900,5902,5905,5920,5937,5952,5969,5984,5996,5998,6e3,6016,6067,6103,6103,6108,6108,6176,6263,6272,6312,6314,6314,6320,6389,6400,6428,6480,6509,6512,6516,6528,6571,6593,6599,6656,6678,6688,6740,6823,6823,6917,6963,6981,6987,7043,7072,7086,7087,7104,7141,7168,7203,7245,7247,7258,7293,7401,7404,7406,7409,7424,7615,7680,7957,7960,7965,7968,8005,8008,8013,8016,8023,8025,8025,8027,8027,8029,8029,8031,8061,8064,8116,8118,8124,8126,8126,8130,8132,8134,8140,8144,8147,8150,8155,8160,8172,8178,8180,8182,8188,8305,8305,8319,8319,8336,8348,8450,8450,8455,8455,8458,8467,8469,8469,8473,8477,8484,8484,8486,8486,8488,8488,8490,8493,8495,8505,8508,8511,8517,8521,8526,8526,8544,8584,11264,11310,11312,11358,11360,11492,11499,11502,11520,11557,11568,11621,11631,11631,11648,11670,11680,11686,11688,11694,11696,11702,11704,11710,11712,11718,11720,11726,11728,11734,11736,11742,11823,11823,12293,12295,12321,12329,12337,12341,12344,12348,12353,12438,12445,12447,12449,12538,12540,12543,12549,12589,12593,12686,12704,12730,12784,12799,13312,13312,19893,19893,19968,19968,40907,40907,40960,42124,42192,42237,42240,42508,42512,42527,42538,42539,42560,42606,42623,42647,42656,42735,42775,42783,42786,42888,42891,42894,42896,42897,42912,42921,43002,43009,43011,43013,43015,43018,43020,43042,43072,43123,43138,43187,43250,43255,43259,43259,43274,43301,43312,43334,43360,43388,43396,43442,43471,43471,43520,43560,43584,43586,43588,43595,43616,43638,43642,43642,43648,43695,43697,43697,43701,43702,43705,43709,43712,43712,43714,43714,43739,43741,43777,43782,43785,43790,43793,43798,43808,43814,43816,43822,43968,44002,44032,44032,55203,55203,55216,55238,55243,55291,63744,64045,64048,64109,64112,64217,64256,64262,64275,64279,64285,64285,64287,64296,64298,64310,64312,64316,64318,64318,64320,64321,64323,64324,64326,64433,64467,64829,64848,64911,64914,64967,65008,65019,65136,65140,65142,65276,65313,65338,65345,65370,65382,65470,65474,65479,65482,65487,65490,65495,65498,65500,65536,65547,65549,65574,65576,65594,65596,65597,65599,65613,65616,65629,65664,65786,65856,65908,66176,66204,66208,66256,66304,66334,66352,66378,66432,66461,66464,66499,66504,66511,66513,66517,66560,66717,67584,67589,67592,67592,67594,67637,67639,67640,67644,67644,67647,67669,67840,67861,67872,67897,68096,68096,68112,68115,68117,68119,68121,68147,68192,68220,68352,68405,68416,68437,68448,68466,68608,68680,69635,69687,69763,69807,73728,74606,74752,74850,77824,78894,92160,92728,110592,110593,119808,119892,119894,119964,119966,119967,119970,119970,119973,119974,119977,119980,119982,119993,119995,119995,119997,120003,120005,120069,120071,120074,120077,120084,120086,120092,120094,120121,120123,120126,120128,120132,120134,120134,120138,120144,120146,120485,120488,120512,120514,120538,120540,120570,120572,120596,120598,120628,120630,120654,120656,120686,120688,120712,120714,120744,120746,120770,120772,120779,131072,131072,173782,173782,173824,173824,177972,177972,177984,177984,178205,178205,194560,195101],L=[],z=0;z<128;z++)L[z]=z>=48&&z<=57||36===z||126===z||124===z||z>=65&&z<=90||95===z||45===z||42===z||58===z||91===z||93===z||63===z||37===z||35===z||61===z||z>=97&&z<=122;var $=L,G=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.input=t,this.char=1,this.from=1}var t,a,n;return t=e,(a=[{key:"peek",value:function(e){return this.input.charAt(e||0)}},{key:"skip",value:function(e){e=e||1,this.char+=e,this.input=this.input.slice(e)}},{key:"tokenize",value:function(){for(var e=[],t=this.next();t;)e.push(t),t=this.next();return e}},{key:"next",value:function(){if(this.from=this.char,/\s/.test(this.peek())){for(;/\s/.test(this.peek());)this.from+=1,this.skip();if(""===this.peek())return null}var e=this.scanStringLiteral();return e||((e=this.scanPunctuator()||this.scanNumericLiteral()||this.scanIdentifier()||this.scanTemplateSequence())?(this.skip(e.value.length),e):null)}},{key:"scanTemplateSequence",value:function(){return"["===this.peek()&&"["===this.peek(1)?{type:"templateStart",value:"[[",pos:this.char}:"]"===this.peek()&&"]"===this.peek(1)?{type:"templateEnd",value:"[[",pos:this.char}:null}},{key:"scanIdentifier",value:function(){var e,t,a="",n=0;function i(e){for(var t=0;t<V.length;){if(e<V[t++])return!1;if(e<=V[t++])return!0}return!1}function s(e){return/^[0-9a-fA-F]$/.test(e)}var o=r.a.bind((function(){if(n+=1,"u"!==this.peek(n))return null;var e=this.peek(n+1),t=this.peek(n+2),a=this.peek(n+3),r=this.peek(n+4);return s(e)&&s(t)&&s(a)&&s(r)&&i(parseInt(e+t+a+r,16))?(n+=5,"\\u"+e+t+a+r):null}),this),u=r.a.bind((function(){var e=this.peek(n),t=e.charCodeAt(0);return"*"===e?(n+=1,e):92===t?o():t<128?L[t]?(n+=1,e):null:i(t)?(n+=1,e):null}),this),l=r.a.bind((function(){var e=this.peek(n),t=e.charCodeAt(0);return 92===t?o():t<128?$[t]?(n+=1,e):null:i(t)?(n+=1,e):null}),this);if(null===(t=u()))return null;for(a=t;null!==(t=l());)a+=t;switch(a){case"true":case"false":e="bool";break;default:e="identifier"}return{type:e,value:a,pos:this.char}}},{key:"scanNumericLiteral",value:function(){var e,t=0,a="",n=this.input.length,r=this.peek(t);function i(e){return/^[0-9]$/.test(e)}function s(e){return/^[0-7]$/.test(e)}function o(e){return"$"===e||"_"===e||"\\"===e||e>="a"&&e<="z"||e>="A"&&e<="Z"}if("-"===r&&(a+=r,t+=1,r=this.peek(t)),"."!==r&&!i(r))return null;if("."!==r){if(a+=this.peek(t),t+=1,r=this.peek(t),"0"===a){if("x"===r||"X"===r){for(t+=1,a+=r;t<n&&(r=this.peek(t),/^[0-9a-fA-F]$/.test(r));)a+=r,t+=1;return a.length<=2?{type:"number",value:a,isMalformed:!0,pos:this.char}:t<n&&o(r=this.peek(t))?null:{type:"number",value:a,base:16,isMalformed:!1,pos:this.char}}if(s(r)){for(t+=1,a+=r,e=!1;t<n;){if(i(r=this.peek(t))&&(e=!0),!s(r)){if(!this.isPunctuator(r))return null;break}a+=r,t+=1}return t<n&&o(r=this.peek(t))?null:{type:"number",value:a,base:8,isMalformed:e}}i(r)&&(t+=1,a+=r)}for(;t<n&&i(r=this.peek(t));)a+=r,t+=1}if("."===r)for(a+=r,t+=1;t<n&&i(r=this.peek(t));)a+=r,t+=1;if("e"===r||"E"===r){if(a+=r,t+=1,"+"!==(r=this.peek(t))&&"-"!==r||(a+=this.peek(t),t+=1),!i(r=this.peek(t)))return null;for(a+=r,t+=1;t<n&&i(r=this.peek(t));)a+=r,t+=1}return t<n&&(r=this.peek(t),!this.isPunctuator(r))?null:{type:"number",value:a,base:10,pos:this.char,isMalformed:!isFinite(+a)}}},{key:"isPunctuator",value:function(e){switch(e){case".":case"(":case")":case",":case"{":case"}":return!0}return!1}},{key:"scanPunctuator",value:function(){var e=this.peek();return this.isPunctuator(e)?{type:e,value:e,pos:this.char}:null}},{key:"scanStringLiteral",value:function(){var e=this.peek();if('"'!==e&&"'"!==e)return null;var t="";for(this.skip();this.peek()!==e;){if(""===this.peek())return{type:"string",value:t,isUnclosed:!0,quote:e,pos:this.char};t+=this.peek(),this.skip(1)}return this.skip(),{type:"string",value:t,isUnclosed:!1,quote:e,pos:this.char}}}])&&N(t.prototype,a),n&&N(t,n),e}();function U(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var H=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.expression=t,this.lexer=new G(t),this.tokens=this.lexer.tokenize(),this.index=0}var t,a,n;return t=e,(a=[{key:"getAst",value:function(){return this.start()}},{key:"start",value:function(){try{return this.functionCall()||this.metricExpression()}catch(e){return{type:"error",message:e.message,pos:e.pos}}}},{key:"curlyBraceSegment",value:function(){if(this.match("identifier","{")||this.match("{")){for(var e="";!this.match("")&&!this.match("}");)e+=this.consumeToken().value;return this.match("}")||this.errorMark("Expected closing '}'"),e+=this.consumeToken().value,this.match("identifier")&&(e+=this.consumeToken().value),{type:"segment",value:e}}return null}},{key:"metricSegment",value:function(){var e=this.curlyBraceSegment();if(e)return e;if(this.match("identifier")||this.match("number")){var t=this.consumeToken().value.split(".");return 2===t.length&&(this.tokens.splice(this.index,0,{type:"."}),this.tokens.splice(this.index+1,0,{type:"number",value:t[1]})),{type:"segment",value:t[0]}}this.match("templateStart")||this.errorMark("Expected metric identifier"),this.consumeToken(),this.match("identifier")||this.errorMark("Expected identifier after templateStart");var a={type:"template",value:this.consumeToken().value};return this.match("templateEnd")||this.errorMark("Expected templateEnd"),this.consumeToken(),a}},{key:"metricExpression",value:function(){if(!(this.match("templateStart")||this.match("identifier")||this.match("number")||this.match("{")))return null;var e={type:"metric",segments:[]};for(e.segments.push(this.metricSegment());this.match(".");){this.consumeToken();var t=this.metricSegment();t||this.errorMark("Expected metric identifier"),e.segments.push(t)}return e}},{key:"functionCall",value:function(){if(!this.match("identifier","("))return null;var e={type:"function",name:this.consumeToken().value};return this.consumeToken(),e.params=this.functionParameters(),this.match(")")||this.errorMark("Expected closing parenthesis"),this.consumeToken(),e}},{key:"boolExpression",value:function(){return this.match("bool")?{type:"bool",value:"true"===this.consumeToken().value}:null}},{key:"functionParameters",value:function(){if(this.match(")")||this.match(""))return[];var e=this.functionCall()||this.numericLiteral()||this.seriesRefExpression()||this.boolExpression()||this.metricExpression()||this.stringLiteral();return this.match(",")?(this.consumeToken(),[e].concat(this.functionParameters())):[e]}},{key:"seriesRefExpression",value:function(){return this.match("identifier")&&this.tokens[this.index].value.match(/\#[A-Z]/)?{type:"series-ref",value:this.consumeToken().value}:null}},{key:"numericLiteral",value:function(){return this.match("number")?{type:"number",value:parseFloat(this.consumeToken().value)}:null}},{key:"stringLiteral",value:function(){if(!this.match("string"))return null;var e=this.consumeToken();if(e.isUnclosed)throw{message:"Unclosed string parameter",pos:e.pos};return{type:"string",value:e.value}}},{key:"errorMark",value:function(e){var t=this.tokens[this.index];throw{message:e+" instead found "+(t?t.type:"end of string"),pos:t?t.pos:this.lexer.char}}},{key:"consumeToken",value:function(){return this.index++,this.tokens[this.index-1]}},{key:"matchToken",value:function(e,t){var a=this.tokens[this.index+t];return void 0===a&&""===e||a&&a.type===e}},{key:"match",value:function(e,t){return this.matchToken(e,0)&&(!t||this.matchToken(t,1))}}])&&U(t.prototype,a),n&&U(t,n),e}();function Q(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var W=function(){function e(t,a,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.datasource=t,this.target=a,this.templateSrv=n,this.scopedVars=r,this.parseTarget(),this.removeTagValue="-- remove tag --"}var t,a,n;return e.$inject=["datasource","target","templateSrv","scopedVars"],t=e,(a=[{key:"parseTarget",value:function(){if(this.functions=[],this.segments=[],this.tags=[],this.seriesByTagUsed=!1,this.error=null,!this.target.textEditor){var e=new H(this.target.target).getAst();if(null!==e){if("error"===e.type)return this.error=e.message+" at position: "+e.pos,void(this.target.textEditor=!0);try{this.parseTargetRecursive(e,null)}catch(e){console.log("error parsing target:",e.message),this.error=e.message,this.target.textEditor=!0}this.checkOtherSegmentsIndex=this.segments.length-1}else this.checkOtherSegmentsIndex=0}}},{key:"getSegmentPathUpTo",value:function(e){var t=this.segments.slice(0,e);return r.a.reduce(t,(function(e,t){return e?e+"."+t.value:t.value}),"")}},{key:"parseTargetRecursive",value:function(e,t){var a=this;if(null===e)return null;switch(e.type){case"function":var n=this.datasource.createFuncInstance(e.name,{withDefaultParams:!1});r.a.each(e.params,(function(e){a.parseTargetRecursive(e,n)})),n.updateText(),this.functions.push(n),"seriesByTag"!==n.def.name||this.seriesByTagUsed||(this.seriesByTagUsed=!0,n.hidden=!0,this.tags=this.splitSeriesByTagParams(n));break;case"series-ref":this.segments.length>0||this.getSeriesByTagFuncIndex()>=0?this.addFunctionParameter(t,e.value):this.segments.push(e);break;case"bool":case"string":case"number":this.addFunctionParameter(t,e.value);break;case"metric":this.segments.length||this.tags.length?this.addFunctionParameter(t,r.a.join(r.a.map(e.segments,"value"),".")):this.segments=e.segments}}},{key:"updateSegmentValue",value:function(e,t){this.segments[t].value=e.value}},{key:"addSelectMetricSegment",value:function(){this.segments.push({value:"select metric"})}},{key:"addFunction",value:function(e){this.functions.push(e)}},{key:"addFunctionParameter",value:function(e,t){if(e.params.length>=e.def.params.length&&!r.a.get(r.a.last(e.def.params),"multiple",!1))throw{message:"too many parameters for function "+e.def.name};e.params.push(t)}},{key:"removeFunction",value:function(e){this.functions=r.a.without(this.functions,e)}},{key:"moveFunction",value:function(e,t){var a=this.functions.indexOf(e);r.a.move(this.functions,a,a+t)}},{key:"updateModelTarget",value:function(e){var t=this;if(!this.target.textEditor){var a=this.getSegmentPathUpTo(this.segments.length).replace(/\.select metric$/,"");this.target.target=r.a.reduce(this.functions,(function(e,a){return a.render(e,(function(e){return t.templateSrv.replace(e,t.scopedVars)}))}),a)}this.updateRenderedTarget(this.target,e);var n=!0,i=!1,s=void 0;try{for(var o,u=(e||[])[Symbol.iterator]();!(n=(o=u.next()).done);n=!0){var l=o.value;l.refId!==this.target.refId&&this.updateRenderedTarget(l,e)}}catch(e){i=!0,s=e}finally{try{n||null==u.return||u.return()}finally{if(i)throw s}}}},{key:"updateRenderedTarget",value:function(e,t){var a=r.a.keyBy(t,"refId");delete a[e.refId];var n=/\#([A-Z])/g,i=e.target;for(r.a.each(a,(function(e,t){!function(e,t){var a=0;r.a.each(e,(function(e,r){if(r!==t){var i=n.exec(e.target),s=i&&i.length?i.length-1:0;a+=s}})),e[t].refCount=a}(a,t)}));i.match(n);){var s=i.replace(n,(function(e,t){var n=a[t];return n?(0===n.refCount&&delete a[t],n.refCount--,n.target):e}));if(s===i)break;i=s}delete e.targetFull,e.target!==i&&(e.targetFull=i)}},{key:"splitSeriesByTagParams",value:function(e){var t=/([^\!=~]+)(\!?=~?)(.*)/;return r.a.flatten(r.a.map(e.params,(function(e){var a=t.exec(e);if(a){var n=a.slice(1);if(3===n.length)return{key:n[0],operator:n[1],value:n[2]}}return[]})))}},{key:"getSeriesByTagFuncIndex",value:function(){return r.a.findIndex(this.functions,(function(e){return"seriesByTag"===e.def.name}))}},{key:"getSeriesByTagFunc",value:function(){var e=this.getSeriesByTagFuncIndex();return e>=0?this.functions[e]:void 0}},{key:"addTag",value:function(e){var t=J(e);this.getSeriesByTagFunc().params.push(t),this.tags.push(e)}},{key:"removeTag",value:function(e){this.getSeriesByTagFunc().params.splice(e,1),this.tags.splice(e,1)}},{key:"updateTag",value:function(e,t){if(this.error=null,e.key!==this.removeTagValue){var a=J(e);this.getSeriesByTagFunc().params[t]=a,this.tags[t]=e}else this.removeTag(t)}},{key:"renderTagExpressions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;return r.a.compact(r.a.map(this.tags,(function(t,a){if(a!==e)return t.key+t.operator+t.value})))}}])&&Q(t.prototype,a),n&&Q(t,n),e}();function J(e){return e.key+e.operator+e.value}var X=a("LzXI"),Z=a("Xmxp"),K=a("2KQq");function Y(e){return(Y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ee(e){return function(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function te(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ae(e,t){return!t||"object"!==Y(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ne(e){return(ne=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function re(e,t){return(re=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ie=["=","!=","=~","!=~"],se=function(e){function t(e,a,n,r,i){var s;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(s=ae(this,ne(t).call(this,e,a))).uiSegmentSrv=n,s.templateSrv=r,s.supportsTags=s.datasource.supportsTags,s.paused=!1,s.target.target=s.target.target||"",s.datasource.waitForFuncDefsLoaded().then((function(){s.queryModel=new W(s.datasource,s.target,r),s.buildSegments(!1)})),s.removeTagValue="-- remove tag --",s}var a,n,s;return t.$inject=["$scope","$injector","uiSegmentSrv","templateSrv","$timeout"],function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&re(e,t)}(t,e),a=t,(n=[{key:"parseTarget",value:function(){this.queryModel.parseTarget(),this.buildSegments()}},{key:"toggleEditorMode",value:function(){this.target.textEditor=!this.target.textEditor,this.parseTarget()}},{key:"buildSegments",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.segments=r.a.map(this.queryModel.segments,(function(t){return e.uiSegmentSrv.newSegment(t)}));var a=this.queryModel.checkOtherSegmentsIndex||0;Object(K.a)(this.$scope)(this.checkOtherSegments(a,t)),this.queryModel.seriesByTagUsed&&this.fixTagSegments()}},{key:"addSelectMetricSegment",value:function(){this.queryModel.addSelectMetricSegment(),this.segments.push(this.uiSegmentSrv.newSelectMetric())}},{key:"checkOtherSegments",value:function(e){var t=this,a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(1===this.queryModel.segments.length&&"series-ref"===this.queryModel.segments[0].type)return Promise.resolve();if(0===e)return this.addSelectMetricSegment(),Promise.resolve();var n=this.queryModel.getSegmentPathUpTo(e+1);return""===n?Promise.resolve():this.datasource.metricFindQuery(n).then((function(r){if(0===r.length)""!==n&&a&&(t.queryModel.segments=t.queryModel.segments.splice(0,e),t.segments=t.segments.splice(0,e),t.addSelectMetricSegment());else if(r[0].expandable){if(t.segments.length!==e)return t.checkOtherSegments(e+1);t.addSelectMetricSegment()}})).catch((function(e){Z.b.emit(i.AppEvents.alertError,["Error",e])}))}},{key:"setSegmentFocus",value:function(e){r.a.each(this.segments,(function(t,a){t.focus=e===a}))}},{key:"getAltSegments",value:function(e,t){var a=this,n=t&&t.length>0?"*"+t+"*":"*";e>0&&(n=this.queryModel.getSegmentPathUpTo(e)+"."+n);var i={range:this.panelCtrl.range,requestId:"get-alt-segments"};return this.datasource.metricFindQuery(n,i).then((function(n){var i=r.a.map(n,(function(e){return a.uiSegmentSrv.newSegment({value:e.text,expandable:e.expandable})}));return e>0&&0===i.length?i:(0===e&&r.a.eachRight(a.panelCtrl.panel.targets,(function(e){e.refId!==a.queryModel.target.refId&&i.unshift(a.uiSegmentSrv.newSegment({type:"series-ref",value:"#"+e.refId,expandable:!1}))})),r.a.eachRight(a.templateSrv.variables,(function(e){i.unshift(a.uiSegmentSrv.newSegment({type:"template",value:"$"+e.name,expandable:!0}))})),i.unshift(a.uiSegmentSrv.newSegment("*")),a.supportsTags&&0===e?(a.removeTaggedEntry(i),a.addAltTagSegments(t,i)):i)})).catch((function(e){return[]}))}},{key:"addAltTagSegments",value:function(e,t){return this.getTagsAsSegments(e).then((function(e){return e=r.a.map(e,(function(e){return e.value="tag: "+e.value,e})),t.concat.apply(t,ee(e))}))}},{key:"removeTaggedEntry",value:function(e){e=r.a.remove(e,(function(e){return"_tagged"===e.value}))}},{key:"segmentValueChanged",value:function(e,t){var a=this;if(this.error=null,this.queryModel.updateSegmentValue(e,t),this.queryModel.functions.length>0&&this.queryModel.functions[0].def.fake&&(this.queryModel.functions=[]),"tag"===e.type){var n=e.value.replace("tag: ","");return this.pause(),this.addSeriesByTagFunc(n),null}return e.expandable?Object(K.a)(this.$scope)(this.checkOtherSegments(t+1).then((function(){a.setSegmentFocus(t+1),a.targetChanged()}))):(this.spliceSegments(t+1),this.setSegmentFocus(t+1),this.targetChanged(),null)}},{key:"spliceSegments",value:function(e){this.segments=this.segments.splice(0,e),this.queryModel.segments=this.queryModel.segments.splice(0,e)}},{key:"emptySegments",value:function(){this.queryModel.segments=[],this.segments=[]}},{key:"targetTextChanged",value:function(){this.updateModelTarget(),this.refresh()}},{key:"updateModelTarget",value:function(){this.queryModel.updateModelTarget(this.panelCtrl.panel.targets)}},{key:"targetChanged",value:function(){if(!this.queryModel.error){var e=this.queryModel.target.target;this.updateModelTarget(),this.queryModel.target===e||this.paused||this.panelCtrl.refresh()}}},{key:"addFunction",value:function(e){var t=this.datasource.createFuncInstance(e,{withDefaultParams:!0});t.added=!0,this.queryModel.addFunction(t),this.smartlyHandleNewAliasByNode(t),1===this.segments.length&&this.segments[0].fake&&this.emptySegments(),!t.params.length&&t.added&&this.targetChanged(),"seriesByTag"===t.def.name&&this.parseTarget()}},{key:"removeFunction",value:function(e){this.queryModel.removeFunction(e),this.targetChanged()}},{key:"moveFunction",value:function(e,t){this.queryModel.moveFunction(e,t),this.targetChanged()}},{key:"addSeriesByTagFunc",value:function(e){var t=this.datasource.createFuncInstance("seriesByTag",{withDefaultParams:!1}),a="".concat(e,"=");t.params=[a],this.queryModel.addFunction(t),t.added=!0,this.emptySegments(),this.targetChanged(),this.parseTarget()}},{key:"smartlyHandleNewAliasByNode",value:function(e){if("aliasByNode"===e.def.name)for(var t=0;t<this.segments.length;t++)if(this.segments[t].value.indexOf("*")>=0)return e.params[0]=t,e.added=!1,void this.targetChanged()}},{key:"getAllTags",value:function(){var e=this;return this.datasource.getTags().then((function(t){var a=r.a.map(t,"text");return a.splice(0,0,e.removeTagValue),oe(a)}))}},{key:"getTags",value:function(e,t){var a=this,n=this.queryModel.renderTagExpressions(e);return this.datasource.getTagsAutoComplete(n,t).then((function(e){var t=r.a.map(e,"text");return t.splice(0,0,a.removeTagValue),oe(t)}))}},{key:"getTagsAsSegments",value:function(e){var t=this,a=this.queryModel.renderTagExpressions();return this.datasource.getTagsAutoComplete(a,e).then((function(e){return r.a.map(e,(function(e){return t.uiSegmentSrv.newSegment({value:e.text,type:"tag",expandable:!1})}))}))}},{key:"getTagOperators",value:function(){return oe(ie)}},{key:"getAllTagValues",value:function(e){var t=e.key;return this.datasource.getTagValues(t).then((function(e){return oe(r.a.map(e,"text"))}))}},{key:"getTagValues",value:function(e,t,a){var n=this,i=this.queryModel.renderTagExpressions(t),s=e.key;return this.datasource.getTagValuesAutoComplete(i,s,a).then((function(e){var t=r.a.map(e,"text");return r.a.eachRight(n.templateSrv.variables,(function(e){t.push("${"+e.name+":regex}")})),oe(t)}))}},{key:"tagChanged",value:function(e,t){this.queryModel.updateTag(e,t),this.targetChanged()}},{key:"addNewTag",value:function(e){var t={key:e.value,operator:"=",value:""};this.queryModel.addTag(t),this.targetChanged(),this.fixTagSegments()}},{key:"removeTag",value:function(e){this.queryModel.removeTag(e),this.targetChanged()}},{key:"fixTagSegments",value:function(){this.addTagSegments=[this.uiSegmentSrv.newPlusButton()]}},{key:"showDelimiter",value:function(e){return e!==this.queryModel.tags.length-1}},{key:"pause",value:function(){this.paused=!0}},{key:"unpause",value:function(){this.paused=!1,this.panelCtrl.refresh()}},{key:"getCollapsedText",value:function(){return this.target.target}}])&&te(a.prototype,n),s&&te(a,s),t}(X.QueryCtrl);function oe(e){return r.a.map(e,(function(e){return{text:e,value:e}}))}se.templateUrl="partials/query.editor.html";var ue=a("q1tI"),le=a.n(ue),ce=a("kDLi"),me=a("kDDq");function pe(){var e=function(e,t){t||(t=e.slice(0));return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}(["\n    margin-left: 8px;\n    margin-top: 5px;\n  "]);return pe=function(){return e},e}var fe={helpbtn:Object(me.css)(pe())};function he(e){return(he="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ge(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function de(e,t){return!t||"object"!==he(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ye(e){return(ye=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ve(e,t){return(ve=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function be(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var a=[],n=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);n=!0);}catch(e){r=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var ke=[{label:"0.9.x",value:"0.9"},{label:"1.0.x",value:"1.0"},{label:"1.1.x",value:"1.1"}],Se=Object.entries(y).map((function(e){var t=be(e,2);return{label:t[0],value:t[1]}})),Te=function(e){function t(e){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(a=de(this,ye(t).call(this,e))).state={showMetricTankHelp:!1},a}var a,n,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ve(e,t)}(t,e),a=t,(n=[{key:"render",value:function(){var e,t=this,a=this.props,n=a.options,r=a.onOptionsChange,s=this.state.showMetricTankHelp,o=null!==(e=ke.find((function(e){return e.value===n.jsonData.graphiteVersion})))&&void 0!==e?e:ke[2];return le.a.createElement(le.a.Fragment,null,le.a.createElement(ce.DataSourceHttpSettings,{defaultUrl:"http://localhost:8080",dataSourceConfig:n,onChange:r}),le.a.createElement("h3",{className:"page-heading"},"Graphite details"),le.a.createElement("div",{className:"gf-form-group"},le.a.createElement("div",{className:"gf-form-inline"},le.a.createElement("div",{className:"gf-form"},le.a.createElement(ce.FormLabel,{tooltip:"This option controls what functions are available in the Graphite query editor."},"Version"),le.a.createElement(ce.Select,{value:o,options:ke,width:8,onChange:Object(i.onUpdateDatasourceJsonDataOptionSelect)(this.props,"graphiteVersion")}))),le.a.createElement("div",{className:"gf-form-inline"},le.a.createElement("div",{className:"gf-form"},le.a.createElement(ce.FormLabel,null,"Type"),le.a.createElement(ce.Select,{options:Se,value:Se.find((function(e){return e.value===n.jsonData.graphiteType})),width:8,onChange:Object(i.onUpdateDatasourceJsonDataOptionSelect)(this.props,"graphiteType")}),le.a.createElement("div",{className:fe.helpbtn},le.a.createElement(ce.Button,{variant:"secondary",size:"sm",onClick:function(){return t.setState((function(e){return{showMetricTankHelp:!e.showMetricTankHelp}}))}},"Help ",le.a.createElement("i",{className:s?"fa fa-caret-down":"fa fa-caret-right"}))))),s&&le.a.createElement("div",{className:"grafana-info-box m-t-2"},le.a.createElement("div",{className:"alert-body"},le.a.createElement("p",null,"There are different types of Graphite compatible backends. Here you can specify the type you are using. If you are using"," ",le.a.createElement("a",{href:"https://github.com/grafana/metrictank",className:"pointer",target:"_blank"},"Metrictank")," ","then select that here. This will enable Metrictank specific features like query processing meta data. Metrictank is a multi-tenant timeseries engine for Graphite and friends.")))))}}])&&ge(a.prototype,n),r&&ge(a,r),t}(ue.PureComponent);function Pe(e){if(e)return parseInt(e,10)}function we(e){if(e)return"true"===e||"false"!==e&&parseInt(e,10)}function xe(e){return e?e.split(",").map((function(e){var t=e.split(":");return{interval:t[0],retention:t[1],chunkspan:t[2],numchunks:Pe(t[3]),ready:we(t[4])}})):[]}function Ce(e){return(Ce="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Oe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ee(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Fe(e,t){return!t||"object"!==Ce(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Me(e){return(Me=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function qe(e,t){return(qe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var _e=function(e){function t(){var e,a;Oe(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Fe(this,(e=Me(t)).call.apply(e,[this].concat(r)))).state={index:0},a.renderInfo=function(e,t){var a=xe(e["schema-retentions"]);return le.a.createElement("div",null,le.a.createElement("h3",null,"Info"),le.a.createElement("table",null,le.a.createElement("tbody",null,a.map((function(e){return le.a.createElement("tr",{key:e.interval},le.a.createElement("td",null,e.interval," "),le.a.createElement("td",null,e.retention," "),le.a.createElement("td",null,e.chunkspan," "),le.a.createElement("td",null,e.numchunks," "),le.a.createElement("td",null,e.ready," "))})))),le.a.createElement("pre",null,JSON.stringify(e,null,2)))},a}var a,n,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&qe(e,t)}(t,e),a=t,(n=[{key:"render",value:function(){var e,t=this,a=this.props.data;if(!a||!a.length)return le.a.createElement("div",null,"No Metadata");var n=a[this.state.index],r=null===(e=n.meta)||void 0===e?void 0:e.custom;return r&&r.info?le.a.createElement("div",null,le.a.createElement("h3",null,"MetricTank Request"),le.a.createElement("pre",null,JSON.stringify(r.request,null,2)),r.info.map((function(e){return t.renderInfo(e,n)}))):le.a.createElement(le.a.Fragment,null,"No Metadatata on DataFrame")}}])&&Ee(a.prototype,n),r&&Ee(a,r),t}(ue.PureComponent);a.d(t,"plugin",(function(){return Ae}));var je=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)};je.templateUrl="partials/annotations.editor.html";var Ae=new i.DataSourcePlugin(F).setQueryCtrl(se).setConfigEditor(Te).setMetadataInspector(_e).setAnnotationQueryCtrl(je)}}]);
//# sourceMappingURL=graphitePlugin.fc25e2ef18cf58c0ed79.js.map